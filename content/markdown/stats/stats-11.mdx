````tsx
"use client"

import type React from "react"
import { useState } from "react"

import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Box, Edit, X } from "lucide-react"

interface MetricCardProps {
  title: string
  value: string
  limit: string
  percentage: number
  status?: string
  statusColor?: string
  progressColor: string
  details?: Array<{ label: string; value: string; color: string }>
  actionLabel: string
  actionIcon: React.ReactNode
  warningMessage?: string
  onActionClick?: () => void
}

function MetricCard({
  title,
  value,
  limit,
  percentage,
  status,
  statusColor = "text-emerald-700",
  progressColor,
  details,
  actionLabel,
  actionIcon,
  warningMessage,
  onActionClick,
}: MetricCardProps) {
  const renderProgressBar = () => {
    if (details && title === "Commands") {
      const writes = Number.parseInt(details[0].value.replace(/,/g, ""))
      const reads = Number.parseInt(details[1].value.replace(/,/g, ""))
      const total = writes + reads
      const writesPercentage = (writes / total) * 100
      const readsPercentage = (reads / total) * 100

      return (
        <div className="relative h-1 w-full overflow-hidden rounded-full bg-zinc-200">
          <div
            className="absolute left-0 h-full bg-emerald-500 transition-all duration-300"
            style={{ width: `${writesPercentage}%` }}
          />
          <div
            className="absolute h-full bg-blue-500 transition-all duration-300"
            style={{ left: `${writesPercentage}%`, width: `${readsPercentage}%` }}
          />
        </div>
      )
    }

    return (
      <div className="relative h-1 w-full overflow-hidden rounded-full bg-zinc-200">
        <div
          className={`h-full transition-all duration-300 ${progressColor}`}
          style={{ width: `${Math.min(percentage, 100)}%` }}
        />
      </div>
    )
  }

  return (
    <Card className="relative overflow-hidden border-zinc-200 bg-white shadow-sm">
      <CardContent className="p-4 pt-0 pb-5">
        <h5 className="text-xs font-normal leading-none tracking-wide text-zinc-400 uppercase">{title}</h5>

        <div className="mt-2 flex items-baseline gap-1">
          <div className="text-[1.2rem] font-medium leading-none text-zinc-950 tabular-nums">{value}</div>
          <div className="text-xs leading-none text-zinc-400">/ {limit}</div>
        </div>

        <div className="mt-3">
          {renderProgressBar()}

          {details && (
            <div className="mt-4">
              <div className="flex flex-col gap-3">
                {details.map((detail, index) => (
                  <div key={index} className="flex w-full items-center text-xs leading-none text-zinc-600">
                    <div className={`mr-[6px] h-2 w-2 rounded-full ${detail.color}`} />
                    <div className="mr-1">{detail.label}</div>
                    <div className="h-[9px] flex-1 border-b-2 border-dotted border-zinc-300" />
                    <div className="ml-1 tabular-nums">{detail.value}</div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {status && (
            <div className="pt-2">
              <div className={statusColor}>{status}</div>
            </div>
          )}

          {warningMessage && (
            <div className="pt-2">
              <div className="text-amber-700 text-sm">{warningMessage}</div>
            </div>
          )}
        </div>

        <div className="absolute bottom-0 left-0 right-0">
          <Button
            variant="ghost"
            className="h-8 w-full rounded-none bg-zinc-50 text-blue-500 hover:bg-zinc-100 hover:text-blue-600"
            onClick={onActionClick}
          >
            {actionIcon}
            <span className="ml-1 text-xs">{actionLabel}</span>
          </Button>
        </div>
      </CardContent>
    </Card>
  )
}

function BudgetDialog({ open, onOpenChange }: { open: boolean; onOpenChange: (open: boolean) => void }) {
  const [budget, setBudget] = useState("20")

  const handleUpdate = () => {
    console.log("Updating budget to:", budget)
    onOpenChange(false)
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader className="flex flex-row items-center justify-between space-y-0 pb-4">
          <DialogTitle className="text-xl font-medium">Update Budget</DialogTitle>
          <Button variant="ghost" size="sm" className="h-6 w-6 p-0" onClick={() => onOpenChange(false)}>
            <X className="h-4 w-4" />
          </Button>
        </DialogHeader>

        <div className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="budget" className="text-base font-normal">
              Max Budget Per Month
            </Label>
            <div className="relative">
              <div className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">$</div>
              <Input
                id="budget"
                value={budget}
                onChange={(e) => setBudget(e.target.value)}
                className="pl-8 text-base"
                placeholder="20"
              />
            </div>
          </div>

          <div className="rounded-lg bg-yellow-50 border border-yellow-200 p-4">
            <p className="text-sm text-yellow-800">
              When your monthly cost reaches the max budget, we send an email to inform you and throttle your database.
              You will not be charged beyond your set budget for this database.
            </p>
          </div>

          <div className="flex justify-end gap-3 pt-2">
            <Button variant="outline" onClick={() => onOpenChange(false)}>
              Cancel
            </Button>
            <Button onClick={handleUpdate} className="bg-emerald-600 hover:bg-emerald-700">
              Update
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  )
}

export default function Stats11() {
  const [budgetDialogOpen, setBudgetDialogOpen] = useState(false)

  return (
    <>
      <div className="grid grid-cols-1 gap-3 rounded-2xl bg-zinc-100 p-3 md:grid-cols-2 lg:grid-cols-4">
        <MetricCard
          title="Commands"
          value="25M"
          limit="Unlimited"
          percentage={85}
          progressColor="bg-blue-500"
          details={[
            { label: "Writes", value: "21,251,966", color: "bg-emerald-500" },
            { label: "Reads", value: "3,812,122", color: "bg-blue-500" },
          ]}
          actionLabel="Upgrade"
          actionIcon={<Box className="h-4 w-4" />}
        />

        <MetricCard
          title="Bandwidth"
          value="169 GB"
          limit="200 GB"
          percentage={84.5}
          progressColor="bg-orange-500"
          warningMessage="There will be a charge for the excessive bandwidth over the limit."
          actionLabel="Upgrade"
          actionIcon={<Box className="h-4 w-4" />}
        />

        <MetricCard
          title="Storage"
          value="2 MB"
          limit="100 GB"
          percentage={0.002}
          progressColor="bg-emerald-500"
          status="It's all right."
          actionLabel="Upgrade"
          actionIcon={<Box className="h-4 w-4" />}
        />

        <MetricCard
          title="Cost"
          value="$50.13"
          limit="$100 Budget"
          percentage={50.13}
          progressColor="bg-emerald-500"
          status="It's all right."
          actionLabel="Change Budget"
          actionIcon={<Edit className="h-4 w-4" />}
          onActionClick={() => setBudgetDialogOpen(true)}
        />
      </div>

      <BudgetDialog open={budgetDialogOpen} onOpenChange={setBudgetDialogOpen} />
    </>
  )
}
````